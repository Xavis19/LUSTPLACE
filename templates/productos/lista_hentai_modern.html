{% extends 'base_hentai_modern.html' %}
{% load productos_filters %}
{% load static %}

{% block title %}🔥 Productos Premium - MarketPlace LUST{% endblock %}

{% block extra_css %}
<style>
    /* ESTILOS REVOLUCIONARIOS PARA FILTROS */
    
    /* Animación de pulso para el resplandor */
    @keyframes glow-pulse {
        0%, 100% { opacity: 0.5; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.05); }
    }
    
    /* Efecto neomórfico en inputs */
    input:focus, select:focus {
        box-shadow: 
            inset 2px 2px 5px rgba(0, 0, 0, 0.5),
            inset -2px -2px 5px rgba(255, 255, 255, 0.05),
            0 0 20px currentColor;
    }
    
    /* Animación del botón de filtro */
    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    
    /* Chips de filtros activos */
    #active-filters > div {
        animation: slideInRight 0.3s ease-out;
    }
    
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    /* Efecto hover en los iconos */
    .group:hover i {
        filter: drop-shadow(0 0 8px currentColor);
    }
    
    /* Gradiente animado en el header */
    @keyframes gradient-shift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }
    
    /* Select personalizado */
    select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%238b5cf6'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 1.5em 1.5em;
    }
    
    /* ESTILOS ORIGINALES MEJORADOS */
    body {
        overflow-x: hidden;
        position: relative;
    }
    
    .main-container {
        position: relative;
        z-index: 1;
        min-height: 100vh;
    }
    
    .filters-container {
        position: relative;
        z-index: 10;
        background: rgba(13, 13, 19, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 24px;
        border: 1px solid rgba(139, 92, 246, 0.2);
    }
    
    #products-grid {
        position: relative;
        z-index: 5;
        margin-top: 2rem;
    }
    
    .product-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        background: rgba(13, 13, 19, 0.8);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(139, 92, 246, 0.15);
        transform: translateZ(0);
    }
    
    .product-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.1), transparent);
        transition: left 0.6s ease;
        z-index: 1;
    }
    
    .product-card:hover::before {
        left: 100%;
    }
    
    .product-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 25px 50px rgba(139, 92, 246, 0.25);
        border-color: rgba(255, 107, 53, 0.4);
    }
    
    .product-image {
        transition: all 0.4s ease;
        filter: brightness(0.9) contrast(1.1);
        position: relative;
        z-index: 2;
    }
    
    .product-card:hover .product-image {
        transform: scale(1.08);
        filter: brightness(1.1) contrast(1.2);
    }
    
    .waifu-assistant {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        cursor: pointer;
        background: rgba(13, 13, 19, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 50%;
        padding: 10px;
        border: 2px solid rgba(255, 107, 53, 0.3);
    }
    
    .promotion-card {
        background: rgba(30, 30, 45, 0.7);
        backdrop-filter: blur(15px);
        border: 2px solid rgba(139, 92, 246, 0.2);
        position: relative;
        overflow: hidden;
        transform: translateZ(0);
    }
    
    .promotion-card::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: conic-gradient(from 0deg, #ff6b35, #8b5cf6, #7c3aed, #c4b5fd, #ff6b35);
        z-index: -1;
        animation: spin 12s linear infinite;
        border-radius: inherit;
    }
    
    .glass-card {
        background: rgba(30, 30, 45, 0.6) !important;
        backdrop-filter: blur(12px) !important;
        border: 1px solid rgba(139, 92, 246, 0.15) !important;
    }
    
    .hero {
        position: relative;
        z-index: 5;
        overflow: hidden;
    }
    
    .navbar {
        position: relative;
        z-index: 50;
        background: rgba(30, 30, 45, 0.9) !important;
        backdrop-filter: blur(15px) !important;
    }
    
    .container {
        max-width: 100%;
        overflow-x: hidden;
    }
    
    /* Animaciones suaves */
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    /* Responsive fixes */
    @media (max-width: 768px) {
        .product-card {
            margin-bottom: 1rem;
        }
        
        #products-grid {
            gap: 1rem;
        }
        
        .filters-container {
            padding: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section con Waifu -->
<section class="hero min-h-[60vh] relative overflow-hidden" data-aos="fade-up">
    <div class="hero-content text-center relative z-10">
        <div class="max-w-4xl mx-auto px-4">
            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <!-- Hero Text -->
                <div class="text-left" data-aos="fade-right">
                    <h1 class="text-5xl lg:text-7xl font-black mb-6">
                        <span class="text-slate-200 font-extrabold">
                            Marketplace
                        </span>
                        <br>
                        <span class="text-purple-600 font-extrabold">LUST</span>
                    </h1>
                    <p class="text-xl lg:text-2xl text-slate-300 font-semibold mb-8 leading-relaxed">
                        Descubre el paraíso del <span class="text-orange-300 font-bold">contenido premium</span> 
                        con la mejor selección de <span class="text-purple-400 font-bold">fantasías</span> 
                        y productos <span class="text-orange-300 font-bold">exclusivos</span>
                    </p>
                    
                    <div class="flex flex-wrap gap-4 mb-8">
                        <div class="badge badge-lg bg-neon-pink/20 text-neon-pink border-neon-pink">
                            <i class="fas fa-fire mr-2"></i>
                            Más de 1000 productos
                        </div>
                        <div class="badge badge-lg bg-neon-purple/20 text-neon-purple border-neon-purple">
                            <i class="fas fa-crown mr-2"></i>
                            Calidad Premium
                        </div>
                        <div class="badge badge-lg bg-neon-cyan/20 text-neon-cyan border-neon-cyan">
                            <i class="fas fa-shield-alt mr-2"></i>
                            100% Discreto
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-4">
                        <button class="btn btn-lg bg-gradient-to-r from-neon-pink to-hentai-purple hover:from-hentai-purple hover:to-neon-cyan border-none text-white font-bold neon-border hover-glow" onclick="scrollToProducts()">
                            <i class="fas fa-rocket mr-2"></i>
                            Explorar Ahora
                        </button>
                    </div>
                </div>
                
                <!-- Hero Waifu -->
                <div class="flex justify-center" data-aos="fade-left">
                    <div class="waifu-container w-80 h-80 flex items-center justify-center animate-float">
                        <div class="text-9xl cursor-pointer" id="hero-waifu" onclick="createParticleEffect(this, 'hearts')">
                            🥰❤️
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Sección de Promociones -->
{% if promociones %}
<section class="py-16 relative" data-aos="fade-up">
    <div class="container mx-auto px-4">
        <div class="text-center mb-12">
            <h2 class="text-4xl lg:text-5xl font-bold mb-4">
                <span class="text-orange-400 font-extrabold">
                    🔥 MARKETPLACELUST
                </span>
            </h2>
            <p class="text-xl text-slate-300 font-semibold mb-8">Ofertas limitadas que no puedes perderte</p>
            
            <!-- Waifu Promociones -->
            <div class="flex justify-center mb-8">
                <div class="waifu-container w-24 h-24 flex items-center justify-center animate-bounce-slow">
                    <div class="text-4xl cursor-pointer" onclick="createParticleEffect(this, 'stars')">
                        🎉
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Carrusel de Promociones -->
        <div class="swiper promotion-swiper mb-12" x-data="{ currentSlide: 0 }">
            <div class="grid lg:grid-cols-3 gap-8">
                {% for promocion in promociones %}
                <div class="promotion-card glass-card rounded-3xl p-8 hover-glow" data-aos="zoom-in" data-aos-delay="{{ forloop.counter0|mul:100 }}">
                    <div class="text-center">
                        <div class="text-6xl mb-4 animate-pulse">🔥</div>
                        <h3 class="text-2xl font-bold text-white mb-4">{{ promocion.titulo }}</h3>
                        <p class="text-gray-300 mb-6">{{ promocion.descripcion|truncatewords:20 }}</p>
                        
                        {% if promocion.descuento_porcentaje > 0 %}
                        <div class="flex justify-center items-center space-x-4 mb-6">
                            <span class="text-3xl font-bold text-neon-pink">{{ promocion.descuento_porcentaje|floatformat:0 }}%</span>
                            <span class="text-lg text-gray-400">OFF</span>
                        </div>
                        {% endif %}
                        
                        <a href="{% url 'productos_promocion' promocion.id %}" class="btn w-full bg-gradient-to-r from-neon-pink to-neon-purple border-none text-white hover:from-neon-purple hover:to-neon-cyan" onclick="createParticleEffect(this, 'magic')">
                            <i class="fas fa-shopping-cart mr-2"></i>
                            ¡Aprovechar Oferta!
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Filtros y Búsqueda - Diseño Revolucionario -->
<section class="py-8" id="products-section">
    <div class="container mx-auto px-4">
        <!-- Barra de filtros flotante con efecto neomórfico -->
        <div class="relative" data-aos="zoom-in" data-aos-duration="800">
            <!-- Efecto de resplandor de fondo -->
            <div class="absolute inset-0 bg-gradient-to-r from-neon-pink/20 via-neon-purple/20 to-neon-cyan/20 rounded-3xl blur-2xl animate-pulse"></div>
            
            <!-- Contenedor principal -->
            <div class="relative glass-card rounded-3xl overflow-hidden border border-white/10">
                <!-- Header decorativo con gradiente -->
                <div class="bg-gradient-to-r from-neon-pink/10 via-neon-purple/10 to-neon-cyan/10 px-8 py-4 border-b border-white/5">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold bg-gradient-to-r from-neon-pink via-neon-purple to-neon-cyan bg-clip-text text-transparent">
                            <i class="fas fa-sliders-h mr-3"></i>Filtros Inteligentes
                        </h3>
                        <button id="clear-filters" class="text-sm text-gray-400 hover:text-neon-pink transition-colors duration-300">
                            <i class="fas fa-times-circle mr-1"></i>Limpiar
                        </button>
                    </div>
                </div>

                <!-- Grid de filtros modernos -->
                <div class="p-8">
                    <div class="grid lg:grid-cols-4 gap-6">
                        <!-- Búsqueda con icono animado -->
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-4 flex items-center pointer-events-none">
                                <i class="fas fa-search text-neon-pink group-focus-within:scale-110 transition-transform duration-300"></i>
                            </div>
                            <input type="text" 
                                   id="search-input" 
                                   class="w-full pl-12 pr-4 py-4 bg-dark-card/50 border border-gray-700/50 rounded-2xl text-white placeholder-gray-500 
                                          focus:border-neon-pink focus:bg-dark-card focus:ring-2 focus:ring-neon-pink/20 transition-all duration-300
                                          hover:border-neon-pink/50" 
                                   placeholder="Busca tu producto favorito..." 
                                   value="{{ request.GET.q }}">
                            <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-neon-pink/0 to-neon-pink/0 group-focus-within:from-neon-pink/5 group-focus-within:to-transparent transition-all duration-300 pointer-events-none"></div>
                        </div>
                        
                        <!-- Categoría con diseño moderno -->
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-4 flex items-center pointer-events-none z-10">
                                <i class="fas fa-tags text-neon-purple group-focus-within:rotate-12 transition-transform duration-300"></i>
                            </div>
                            <select id="category-select" 
                                    class="w-full pl-12 pr-4 py-4 bg-dark-card/50 border border-gray-700/50 rounded-2xl text-white appearance-none cursor-pointer
                                           focus:border-neon-purple focus:bg-dark-card focus:ring-2 focus:ring-neon-purple/20 transition-all duration-300
                                           hover:border-neon-purple/50">
                                <option value="">Todas las categorías</option>
                                {% for categoria in categorias %}
                                <option value="{{ categoria.id }}" {% if categoria.id|stringformat:"s" == request.GET.categoria %}selected{% endif %}>
                                    {{ categoria.nombre }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="absolute inset-y-0 right-4 flex items-center pointer-events-none">
                                <i class="fas fa-chevron-down text-neon-purple text-sm"></i>
                            </div>
                        </div>
                        
                        <!-- Precio con slider visual -->
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-4 flex items-center pointer-events-none">
                                <i class="fas fa-dollar-sign text-neon-cyan group-focus-within:animate-bounce"></i>
                            </div>
                            <input type="number" 
                                   id="price-input"
                                   class="w-full pl-12 pr-4 py-4 bg-dark-card/50 border border-gray-700/50 rounded-2xl text-white placeholder-gray-500
                                          focus:border-neon-cyan focus:bg-dark-card focus:ring-2 focus:ring-neon-cyan/20 transition-all duration-300
                                          hover:border-neon-cyan/50" 
                                   placeholder="Precio máximo" 
                                   value="{{ request.GET.precio_max }}">
                            <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-neon-cyan/0 to-neon-cyan/0 group-focus-within:from-neon-cyan/5 group-focus-within:to-transparent transition-all duration-300 pointer-events-none"></div>
                        </div>
                        
                        <!-- Botón de acción futurista -->
                        <button id="filter-btn" 
                                class="relative overflow-hidden group bg-gradient-to-r from-neon-pink via-neon-purple to-neon-cyan rounded-2xl p-[2px] hover:scale-105 transition-all duration-300">
                            <div class="relative bg-dark-card rounded-2xl px-6 py-4 group-hover:bg-transparent transition-all duration-300">
                                <div class="flex items-center justify-center gap-2 text-white font-semibold">
                                    <i class="fas fa-magic group-hover:rotate-180 transition-transform duration-500"></i>
                                    <span>Aplicar Filtros</span>
                                </div>
                            </div>
                            <!-- Efecto de brillo animado -->
                            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-1000"></div>
                        </button>
                    </div>

                    <!-- Chips de filtros activos -->
                    <div id="active-filters" class="mt-6 flex flex-wrap gap-2 empty:hidden">
                        <!-- Se llenarán dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Grid de Productos -->
<section class="py-12">
    <div class="container mx-auto px-4">
        <div class="mb-8">
            <!-- Productos Disponibles con estilo morado -->
            <div class="inline-flex items-center space-x-3 bg-purple-600 rounded-full px-6 py-3 shadow-lg">
                <div class="text-2xl">🛍️</div>
                <span class="text-orange-400 font-bold text-lg">productos encontrados</span>
            </div>
        </div>
        
        <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            {% for producto in productos %}
            <div class="product-card glass-card rounded-3xl p-6 hover-glow" data-aos="zoom-in" data-aos-delay="{{ forloop.counter0|mul:50 }}">
                <!-- Imagen del producto -->
                <div class="aspect-square mb-4 rounded-2xl overflow-hidden relative">
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" 
                             alt="{{ producto.nombre }}" 
                             class="product-image w-full h-full object-cover">
                    {% else %}
                        <div class="w-full h-full bg-gradient-to-br from-neon-pink/20 to-neon-purple/20 flex items-center justify-center text-6xl">
                            🎁
                        </div>
                    {% endif %}
                    

                </div>
                
                <!-- Info del producto -->
                <div class="space-y-3">
                    <h3 class="font-bold text-lg text-white line-clamp-2 hover:text-neon-pink transition-colors duration-300">
                        {{ producto.nombre }}
                    </h3>
                    
                    <p class="text-gray-400 text-sm line-clamp-3">
                        {{ producto.descripcion|truncatewords:15 }}
                    </p>
                    
                    <div class="flex items-center justify-between">
                        <div class="text-2xl font-bold text-neon-pink">
                            ${{ producto.precio }}
                        </div>
                        <div class="flex items-center space-x-1 text-yellow-400">
                            {% for i in "12345" %}
                                {% if forloop.counter <= 4 %}
                                    <i class="fas fa-star text-sm"></i>
                                {% else %}
                                    <i class="far fa-star text-sm"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <a href="{% url 'detalle_producto' producto.id %}" class="btn btn-sm flex-1 bg-gradient-to-r from-neon-purple to-neon-pink border-none text-white hover:from-neon-pink hover:to-neon-cyan">
                            Ver Detalles
                        </a>
                        <button class="btn btn-sm btn-outline border-neon-cyan text-neon-cyan hover:bg-neon-cyan hover:text-dark-bg" onclick="createParticleEffect(this, 'stars')">
                            <i class="fas fa-cart-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full text-center py-16">
                <div class="text-8xl mb-4 animate-bounce-slow">😢</div>
                <h3 class="text-2xl font-bold text-gray-400 mb-2">No se encontraron productos</h3>
                <p class="text-gray-500">Intenta con otros filtros o términos de búsqueda</p>
            </div>
            {% endfor %}
        </div>
        
        <!-- Paginación -->
        {% if productos.has_other_pages %}
        <div class="flex justify-center mt-16" data-aos="fade-up">
            <div class="btn-group glass-card-light rounded-2xl p-2">
                {% if productos.has_previous %}
                    <a href="?page={{ productos.previous_page_number }}" class="btn btn-outline border-neon-pink text-neon-pink hover:bg-neon-pink hover:text-white">
                        <i class="fas fa-chevron-left mr-2"></i>Anterior
                    </a>
                {% endif %}
                
                <span class="btn btn-ghost text-white font-bold">
                    Página {{ productos.number }} de {{ productos.paginator.num_pages }}
                </span>
                
                {% if productos.has_next %}
                    <a href="?page={{ productos.next_page_number }}" class="btn btn-outline border-neon-cyan text-neon-cyan hover:bg-neon-cyan hover:text-dark-bg">
                        Siguiente<i class="fas fa-chevron-right ml-2"></i>
                    </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Waifu Asistente Flotante -->
<div class="waifu-assistant glass-card rounded-full p-4 animate-float" data-aos="zoom-in" data-aos-delay="1000">
    <div class="text-4xl cursor-pointer" id="assistant-waifu" onclick="toggleAssistant()">
        🤖
    </div>
</div>

<!-- Panel de Asistente -->
<div id="assistant-panel" class="fixed bottom-20 right-4 glass-card rounded-3xl p-6 w-80 transform translate-y-full opacity-0 transition-all duration-300 z-50">
    <div class="flex items-center justify-between mb-4">
        <div class="flex items-center space-x-3">
            <div class="text-3xl animate-pulse">🤖</div>
            <div>
                <h3 class="font-bold text-neon-pink">Asistente LUST</h3>
                <p class="text-xs text-gray-400">Aquí para ayudarte</p>
            </div>
        </div>
        <button onclick="toggleAssistant()" class="btn btn-ghost btn-sm btn-circle text-gray-400 hover:text-white">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="space-y-3 text-sm">
        <div class="bg-dark-card rounded-lg p-3">
            <p class="text-gray-300">¡Hola! 👋 ¿Necesitas ayuda para encontrar algo especial?</p>
        </div>
        <div class="flex flex-wrap gap-2">
            <button class="btn btn-xs bg-neon-pink/20 text-neon-pink border-neon-pink">Ver ofertas</button>
            <button class="btn btn-xs bg-neon-purple/20 text-neon-purple border-neon-purple">Productos premium</button>
            <button class="btn btn-xs bg-neon-cyan/20 text-neon-cyan border-neon-cyan">Ayuda</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let assistantOpen = false;
    
    function toggleAssistant() {
        const panel = document.getElementById('assistant-panel');
        const waifu = document.getElementById('assistant-waifu');
        
        assistantOpen = !assistantOpen;
        
        if (assistantOpen) {
            panel.style.transform = 'translateY(0)';
            panel.style.opacity = '1';
            waifu.textContent = '💬';
            createParticleEffect(document.getElementById('assistant-waifu'), 'magic');
        } else {
            panel.style.transform = 'translateY(100%)';
            panel.style.opacity = '0';
            waifu.textContent = '🤖';
        }
    }
    
    function scrollToProducts() {
        document.getElementById('products-section').scrollIntoView({ 
            behavior: 'smooth' 
        });
        createParticleEffect(document.getElementById('hero-waifu'), 'stars');
    }
    
    // Filtros dinámicos AJAX (sin recargar página)
    document.getElementById('filter-btn').addEventListener('click', function() {
        filtrarProductosAjax();
        updateActiveFilters();
    });
    
    // Botón limpiar filtros
    document.getElementById('clear-filters').addEventListener('click', function() {
        document.getElementById('search-input').value = '';
        document.getElementById('category-select').value = '';
        document.getElementById('price-input').value = '';
        document.getElementById('active-filters').innerHTML = '';
        filtrarProductosAjax();
        
        // Animación de limpieza
        this.innerHTML = '<i class="fas fa-check-circle mr-1"></i>Limpiado';
        setTimeout(() => {
            this.innerHTML = '<i class="fas fa-times-circle mr-1"></i>Limpiar';
        }, 2000);
    });
    
    // Actualizar chips de filtros activos
    function updateActiveFilters() {
        const container = document.getElementById('active-filters');
        const search = document.getElementById('search-input').value;
        const category = document.getElementById('category-select');
        const price = document.getElementById('price-input').value;
        
        let html = '<div class="text-sm text-gray-400 mr-2">Filtros activos:</div>';
        
        if (search) {
            html += `
                <div class="flex items-center gap-2 bg-neon-pink/10 border border-neon-pink/30 rounded-full px-4 py-2 text-neon-pink text-sm">
                    <i class="fas fa-search"></i>
                    <span>${search}</span>
                    <button onclick="removeFilter('search')" class="hover:scale-110 transition-transform">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        }
        
        if (category.value) {
            html += `
                <div class="flex items-center gap-2 bg-neon-purple/10 border border-neon-purple/30 rounded-full px-4 py-2 text-neon-purple text-sm">
                    <i class="fas fa-tags"></i>
                    <span>${category.options[category.selectedIndex].text}</span>
                    <button onclick="removeFilter('category')" class="hover:scale-110 transition-transform">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        }
        
        if (price) {
            html += `
                <div class="flex items-center gap-2 bg-neon-cyan/10 border border-neon-cyan/30 rounded-full px-4 py-2 text-neon-cyan text-sm">
                    <i class="fas fa-dollar-sign"></i>
                    <span>Hasta $${price}</span>
                    <button onclick="removeFilter('price')" class="hover:scale-110 transition-transform">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        }
        
        container.innerHTML = (search || category.value || price) ? html : '';
    }
    
    // Remover filtro individual
    function removeFilter(type) {
        if (type === 'search') document.getElementById('search-input').value = '';
        if (type === 'category') document.getElementById('category-select').value = '';
        if (type === 'price') document.getElementById('price-input').value = '';
        filtrarProductosAjax();
        updateActiveFilters();
    }
    
    // Filtro automático al escribir (con debounce)
    let searchTimeout;
    document.getElementById('search-input').addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            filtrarProductosAjax();
        }, 500); // Espera 500ms después de que el usuario deje de escribir
    });
    
    // Filtro automático al cambiar categoría
    document.getElementById('category-select').addEventListener('change', function() {
        filtrarProductosAjax();
    });
    
    function filtrarProductosAjax() {
        const search = document.getElementById('search-input').value;
        const category = document.getElementById('category-select').value;
        const price = document.getElementById('price-input').value;
        
        // Mostrar indicador de carga
        const productsContainer = document.getElementById('products-grid');
        if (productsContainer) {
            productsContainer.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="animate-spin text-4xl text-neon-pink mb-4">⚡</div>
                    <p class="text-gray-400">Filtrando productos...</p>
                </div>
            `;
        }
        
        const params = new URLSearchParams();
        if (search) params.append('q', search);
        if (category) params.append('categoria', category);
        if (price) params.append('precio_max', price);
        
        // Petición AJAX
        fetch('/filtros-ajax/?' + params.toString(), {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        })
        .then(response => response.text())
        .then(html => {
            if (productsContainer) {
                productsContainer.innerHTML = html;
                // Reinicializar animaciones AOS
                if (typeof AOS !== 'undefined') {
                    AOS.refresh();
                }
                // Crear efecto de partículas en el contenedor
                createParticleEffect(productsContainer, 'magic');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            if (productsContainer) {
                productsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-4xl text-red-400 mb-4">❌</div>
                        <p class="text-red-400">Error al cargar productos</p>
                    </div>
                `;
            }
        });
    }
    
    // Cambios dinámicos en la waifu hero
    const heroWaifu = document.getElementById('hero-waifu');
    const waifuEmojis = ['😍', '🥰', '😘', '🤤', '😋', '🤩', '😎'];
    
    setInterval(() => {
        const randomEmoji = waifuEmojis[Math.floor(Math.random() * waifuEmojis.length)];
        heroWaifu.style.transform = 'scale(0.8)';
        
        setTimeout(() => {
            heroWaifu.textContent = randomEmoji;
            heroWaifu.style.transform = 'scale(1.1)';
            
            setTimeout(() => {
                heroWaifu.style.transform = 'scale(1)';
            }, 200);
        }, 150);
    }, 5000);
    
    // GSAP Animations
    gsap.registerPlugin(ScrollTrigger);
    
    // Parallax para las cards de productos
    gsap.utils.toArray('.product-card').forEach(card => {
        gsap.fromTo(card, 
            { y: 50, opacity: 0 },
            {
                y: 0,
                opacity: 1,
                duration: 0.8,
                ease: "power2.out",
                scrollTrigger: {
                    trigger: card,
                    start: "top 90%",
                    end: "bottom 20%",
                    toggleActions: "play none none reverse"
                }
            }
        );
    });
</script>
{% endblock %}
