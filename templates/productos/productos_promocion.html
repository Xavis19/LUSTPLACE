{% extends 'base_hentai_modern.html' %}
{% load static %}

{% block title %}üî• {{ promocion.titulo }} - MarketPlace LUST{% endblock %}

{% block extra_css %}
<style>
    .promo-header {
        backdrop-filter: blur(25px);
        border: 2px solid rgba(255, 0, 128, 0.4);
        transition: all 0.3s ease;
    }
    
    .producto-promo-card {
        background: rgba(26, 26, 46, 0.9);
        backdrop-filter: blur(25px);
        border: 2px solid rgba(255, 0, 128, 0.3);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .producto-promo-card:hover {
        border-color: #ff0080;
        box-shadow: 0 0 30px rgba(255, 0, 128, 0.4);
        transform: translateY(-5px) scale(1.02);
    }
    
    .precio-promocion {
        background: linear-gradient(45deg, #ff0080, #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .descuento-badge {
        background: linear-gradient(45deg, #ff4444, #ff0080);
        animation: pulse 2s infinite;
    }
    
    .promo-particle {
        position: absolute;
        pointer-events: none;
        font-size: 1.2rem;
        opacity: 0.7;
        animation: float 3s ease-in-out infinite;
    }
    
    .glow-effect {
        box-shadow: 
            0 0 20px rgba(255, 0, 128, 0.4),
            0 0 40px rgba(139, 92, 246, 0.3),
            inset 0 0 20px rgba(255, 255, 255, 0.1);
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header de la promoci√≥n -->
    <div class="promo-header rounded-3xl p-8 mb-8 {% if promocion.efecto_glow %}glow-effect{% endif %}" data-aos="fade-up">
        <div class="flex flex-col lg:flex-row items-center gap-8">
            <!-- Imagen de la promoci√≥n -->
            <div class="lg:w-1/3">
                {% if promocion.imagen_principal %}
                    <img src="{{ promocion.imagen_principal.url }}" 
                         alt="{{ promocion.titulo }}" 
                         class="w-full h-64 object-cover rounded-2xl shadow-2xl hover:scale-105 transition-transform duration-300">
                {% else %}
                    <div class="w-full h-64 bg-gradient-to-br from-neon-cyan/20 to-neon-purple/20 rounded-2xl flex items-center justify-center text-6xl">
                        üéÅ
                    </div>
                {% endif %}
            </div>
            
            <!-- Informaci√≥n de la promoci√≥n -->
            <div class="lg:w-2/3 text-center lg:text-left">
                <div class="flex items-center justify-center lg:justify-start gap-3 mb-4">
                    <span class="badge badge-lg bg-gradient-to-r from-neon-pink to-neon-purple text-white font-bold">
                        {{ promocion.get_tipo_display }}
                    </span>
                    {% if promocion.descuento_porcentaje > 0 %}
                    <span class="descuento-badge text-white font-bold px-4 py-2 rounded-full">
                        -{{ promocion.descuento_porcentaje|floatformat:0 }}% OFF
                    </span>
                    {% endif %}
                </div>
                
                <h1 class="text-4xl lg:text-6xl font-bold mb-4 animate-glow">
                    <span class="bg-gradient-to-r from-neon-pink to-neon-purple bg-clip-text text-transparent">
                        {{ promocion.titulo }}
                    </span>
                </h1>
                
                {% if promocion.subtitulo %}
                <h2 class="text-xl lg:text-2xl text-gray-300 mb-6">{{ promocion.subtitulo }}</h2>
                {% endif %}
                
                <p class="text-gray-400 mb-6 text-lg">{{ promocion.descripcion }}</p>
                
                <!-- Estad√≠sticas de la promoci√≥n -->
                <div class="flex flex-wrap justify-center lg:justify-start gap-6 text-sm">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-eye text-neon-cyan"></i>
                        <span class="text-gray-400">{{ promocion.vista_conteo }} vistas</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-mouse-pointer text-neon-purple"></i>
                        <span class="text-gray-400">{{ promocion.click_conteo }} clicks</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-clock text-neon-pink"></i>
                        <span class="text-gray-400">Hasta {{ promocion.fecha_fin|date:"d M Y" }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- T√≠tulo de productos -->
    <div class="text-center mb-12" data-aos="fade-up">
        <h2 class="text-3xl lg:text-4xl font-bold mb-4">
            <span class="bg-gradient-to-r from-neon-cyan via-neon-blue to-neon-purple bg-clip-text text-transparent">
                Productos en Promoci√≥n
            </span>
        </h2>
        <p class="text-xl text-gray-300">
            {% if tiene_descuento %}
                ¬°Precios especiales solo por tiempo limitado!
            {% else %}
                Productos seleccionados para esta promoci√≥n
            {% endif %}
        </p>
    </div>
    
    <!-- Grid de productos -->
    {% if productos %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" data-aos="fade-up">
        {% for item in productos %}
        <div class="producto-promo-card rounded-3xl p-6 hover-glow">
            <!-- Badge de descuento -->
            {% if item.ahorro > 0 %}
            <div class="absolute top-4 right-4 z-10">
                <span class="descuento-badge text-white text-sm font-bold px-3 py-1 rounded-full">
                    ¬°Ahorra ${{ item.ahorro|floatformat:0 }}!
                </span>
            </div>
            {% endif %}
            
            <!-- Imagen del producto -->
            <div class="aspect-square rounded-2xl overflow-hidden mb-4 bg-gradient-to-br from-gray-700 to-gray-800">
                {% if item.producto.imagen %}
                    <img src="{{ item.producto.imagen.url }}" 
                         alt="{{ item.producto.nombre }}" 
                         class="w-full h-full object-cover hover:scale-110 transition-transform duration-300">
                {% else %}
                    <div class="w-full h-full flex items-center justify-center text-6xl text-gray-500">
                        üéÅ
                    </div>
                {% endif %}
            </div>
            
            <!-- Informaci√≥n del producto -->
            <div class="space-y-3">
                <h3 class="text-lg font-bold text-white line-clamp-2 hover:text-neon-pink transition-colors">
                    {{ item.producto.nombre }}
                </h3>
                
                <p class="text-gray-400 text-sm line-clamp-3">
                    {{ item.producto.descripcion|truncatewords:15 }}
                </p>
                
                <!-- Precios -->
                <div class="space-y-2">
                    {% if item.ahorro > 0 %}
                    <div class="flex items-center gap-3">
                        <span class="text-2xl font-bold precio-promocion">
                            ${{ item.precio_final|floatformat:0 }}
                        </span>
                        <span class="text-lg text-gray-500 line-through">
                            ${{ item.precio_original|floatformat:0 }}
                        </span>
                    </div>
                    <p class="text-neon-green text-sm font-medium">
                        ¬°Ahorras ${{ item.ahorro|floatformat:0 }}!
                    </p>
                    {% else %}
                    <div class="text-2xl font-bold text-neon-cyan">
                        ${{ item.precio_final|floatformat:0 }}
                    </div>
                    {% endif %}
                </div>
                
                <!-- Stock -->
                <div class="flex items-center gap-2 text-sm">
                    {% if item.producto.stock > 10 %}
                        <i class="fas fa-check-circle text-neon-green"></i>
                        <span class="text-neon-green">Stock disponible</span>
                    {% elif item.producto.stock > 0 %}
                        <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                        <span class="text-yellow-400">Solo {{ item.producto.stock }} disponibles</span>
                    {% else %}
                        <i class="fas fa-times-circle text-red-400"></i>
                        <span class="text-red-400">Agotado</span>
                    {% endif %}
                </div>
                
                <!-- Botones de acci√≥n -->
                <div class="space-y-3 pt-4">
                    {% if item.producto.stock > 0 %}
                    <form action="{% url 'agregar_al_carrito' item.producto.id %}" method="post" class="w-full">
                        {% csrf_token %}
                        <input type="hidden" name="cantidad" value="1">
                        <button type="submit" 
                                class="btn w-full bg-gradient-to-r from-neon-pink to-neon-purple hover:from-neon-purple hover:to-neon-cyan border-none text-white font-bold neon-border hover-glow"
                                onclick="createParticleEffect(this, 'stars')">
                            <i class="fas fa-shopping-cart mr-2"></i>
                            Agregar al Carrito
                        </button>
                    </form>
                    {% else %}
                    <button disabled class="btn w-full btn-disabled">
                        <i class="fas fa-ban mr-2"></i>
                        Sin Stock
                    </button>
                    {% endif %}
                    
                    <a href="{% url 'detalle_producto' item.producto.id %}" 
                       class="btn btn-outline border-gray-600 text-gray-300 hover:bg-gray-600 hover:border-gray-500 w-full">
                        <i class="fas fa-info-circle mr-2"></i>
                        Ver Detalles
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% else %}
    <!-- Sin productos -->
    <div class="text-center py-16" data-aos="zoom-in">
        <div class="producto-promo-card rounded-3xl p-12 max-w-2xl mx-auto">
            <div class="text-8xl mb-8 animate-bounce-slow">üòî</div>
            
            <h3 class="text-3xl font-bold text-gray-400 mb-4">
                No hay productos disponibles
            </h3>
            
            <p class="text-xl text-gray-500 mb-8">
                Esta promoci√≥n no tiene productos asignados actualmente
            </p>
            
            <a href="{% url 'lista_productos' %}" 
               class="btn btn-lg bg-gradient-to-r from-neon-cyan to-neon-blue hover:from-neon-blue hover:to-neon-purple border-none text-white font-bold neon-border hover-glow">
                <i class="fas fa-arrow-left mr-2"></i>
                Ver Todos los Productos
            </a>
        </div>
    </div>
    {% endif %}
    
    <!-- Informaci√≥n adicional de la promoci√≥n -->
    {% if promocion.url_personalizada or promocion.categoria %}
    <div class="mt-16" data-aos="fade-up">
        <div class="promo-header rounded-3xl p-8 text-center">
            <h3 class="text-2xl font-bold text-neon-purple mb-4">
                <i class="fas fa-info-circle mr-3"></i>
                Informaci√≥n Adicional
            </h3>
            
            <div class="grid md:grid-cols-2 gap-6 mt-6">
                {% if promocion.categoria %}
                <div class="space-y-2">
                    <h4 class="font-bold text-neon-cyan">Categor√≠a</h4>
                    <p class="text-gray-300">{{ promocion.categoria.nombre }}</p>
                </div>
                {% endif %}
                
                <div class="space-y-2">
                    <h4 class="font-bold text-neon-pink">Vigencia</h4>
                    <p class="text-gray-300">
                        Del {{ promocion.fecha_inicio|date:"d/m/Y" }} 
                        al {{ promocion.fecha_fin|date:"d/m/Y" }}
                    </p>
                </div>
            </div>
            
            {% if promocion.url_personalizada %}
            <div class="mt-6">
                <a href="{{ promocion.url_personalizada }}" 
                   class="btn bg-gradient-to-r from-neon-green to-neon-cyan border-none text-white font-bold"
                   target="_blank">
                    <i class="fas fa-external-link-alt mr-2"></i>
                    Ver M√°s Informaci√≥n
                </a>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Part√≠culas flotantes -->
<div class="fixed inset-0 pointer-events-none z-0">
    <div class="promo-particle" style="left: 10%; animation-delay: 0s;">üéÅ</div>
    <div class="promo-particle" style="left: 20%; animation-delay: 1s;">‚ú®</div>
    <div class="promo-particle" style="left: 30%; animation-delay: 2s;">üî•</div>
    <div class="promo-particle" style="left: 40%; animation-delay: 0.5s;">üíé</div>
    <div class="promo-particle" style="left: 60%; animation-delay: 1.5s;">üéØ</div>
    <div class="promo-particle" style="left: 70%; animation-delay: 2.5s;">‚≠ê</div>
    <div class="promo-particle" style="left: 80%; animation-delay: 3s;">üåü</div>
    <div class="promo-particle" style="left: 90%; animation-delay: 0.8s;">üí´</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animaciones de entrada escalonadas
        gsap.fromTo('.producto-promo-card', 
            { opacity: 0, y: 50, scale: 0.9 },
            { 
                opacity: 1, 
                y: 0, 
                scale: 1, 
                duration: 0.6, 
                stagger: 0.1, 
                ease: "back.out(1.7)" 
            }
        );
        
        // Efecto hover mejorado
        document.querySelectorAll('.producto-promo-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                gsap.to(this, { 
                    scale: 1.05, 
                    duration: 0.3, 
                    ease: "power2.out" 
                });
            });
            
            card.addEventListener('mouseleave', function() {
                gsap.to(this, { 
                    scale: 1, 
                    duration: 0.3, 
                    ease: "power2.out" 
                });
            });
        });
        
        // Animaci√≥n de part√≠culas flotantes
        gsap.to('.promo-particle', {
            y: -20,
            duration: 3,
            ease: "power1.inOut",
            yoyo: true,
            repeat: -1,
            stagger: 0.2
        });
        
        // Efecto especial al agregar al carrito
        document.querySelectorAll('form[action*="agregar_al_carrito"] button').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Efecto visual
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Agregando...';
                this.disabled = true;
                
                // Enviar formulario despu√©s de un delay
                setTimeout(() => {
                    this.closest('form').submit();
                }, 800);
            });
        });
    });
</script>
{% endblock %}
